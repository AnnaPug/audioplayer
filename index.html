<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Audio Player Editor</title>
<style>
body {
  margin: 0;
  font-family: Inter, sans-serif;
  background: #0b0f1a;
  color: #fff;
  display: flex;
  height: 100vh;
}

.panel {
  width: 340px;
  padding: 20px;
  background: #11162a;
  overflow-y: auto;
}

label {
  display: block;
  margin-top: 12px;
  font-size: 13px;
  opacity: .8;
}

input, textarea {
  width: 100%;
  margin-top: 6px;
  padding: 8px;
  border-radius: 6px;
  border: none;
  background: #1b2040;
  color: #fff;
}

textarea { height: 120px; }

button {
  margin-top: 14px;
  width: 100%;
  padding: 10px;
  background: #8b5cf6;
  border: none;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
}

.preview {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

iframe {
  border: none;
  background: transparent;
}
</style>
</head>

<body>

<div class="panel">
  <h2>Audio Player Editor</h2>

  <label>–†–∞–∑–º–µ—Ä –ø–ª–µ–µ—Ä–∞</label>
  <input type="range" id="size" min="220" max="420" value="300">

  <label>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</label>
  <input type="color" id="primary" value="#8b5cf6">

  <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
  <input type="color" id="text" value="#ffffff">

  <label>–û–±–ª–æ–∂–∫–∞</label>
  <input id="cover">

  <label>–¢—Ä–µ–∫–∏ (JSON)</label>
  <textarea id="tracks"></textarea>

  <button onclick="updatePreview()">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
  <button onclick="generateCode()">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
</div>

<div class="preview">
  <iframe id="preview"></iframe>
</div>

<script>
function buildPlayer(c) {
return `
<div id="player">
  <img id="cover">
  <canvas id="viz"></canvas>
  <h3 id="title"></h3>

  <input type="range" id="progress">

  <div class="controls">
    <button id="prev">‚èÆ</button>
    <button id="play">‚ñ∂</button>
    <button id="next">‚è≠</button>
    <button id="shuffle">üîÄ</button>
    <button id="listBtn">üìÇ</button>
  </div>

  <input type="range" id="volume" min="0" max="1" step="0.01">

  <div id="playlist"></div>

  <audio id="audio" crossorigin="anonymous"></audio>
</div>

<style>
#player{
  width:${c.size}px;
  color:${c.text};
  font-family:sans-serif;
}

#cover{
  width:100%;
  border-radius:16px;
}

.controls{
  display:flex;
  justify-content:space-between;
}

.controls button{
  background:${c.primary};
  border:none;
  border-radius:50%;
  width:42px;
  height:42px;
  color:#fff;
}

#playlist{
  display:none;
  margin-top:10px;
}
#playlist div{
  cursor:pointer;
  padding:4px;
}
</style>

<script>
const tracks=${JSON.stringify(c.tracks)};
let i=0, shuffle=false;

const audio=document.getElementById('audio');
const play=document.getElementById('play');
const title=document.getElementById('title');
const cover=document.getElementById('cover');
const playlist=document.getElementById('playlist');
const volume=document.getElementById('volume');

cover.src='${c.cover}';
volume.value=0.8;
audio.volume=0.8;

tracks.forEach((t,idx)=>{
  const d=document.createElement('div');
  d.textContent=t.title;
  d.onclick=()=>{load(idx);playAudio();}
  playlist.appendChild(d);
});

function load(n){
  i=n;
  audio.src=tracks[i].src;
  title.textContent=tracks[i].title;
  audio.load();
}

function playAudio(){
  audio.play();
  play.textContent='‚è∏';
}

play.onclick=()=>{
  audio.paused?playAudio():(audio.pause(),play.textContent='‚ñ∂');
};

document.getElementById('next').onclick=()=>{
  i=shuffle?Math.floor(Math.random()*tracks.length):(i+1)%tracks.length;
  load(i);playAudio();
};

document.getElementById('prev').onclick=()=>{
  i=(i-1+tracks.length)%tracks.length;
  load(i);playAudio();
};

document.getElementById('shuffle').onclick=()=>shuffle=!shuffle;
document.getElementById('listBtn').onclick=()=>{
  playlist.style.display=playlist.style.display?'':'block';
};

volume.oninput=e=>audio.volume=e.target.value;
audio.onended=()=>document.getElementById('next').click();

// VISUALIZER
const ctx=new AudioContext();
const src=ctx.createMediaElementSource(audio);
const analyser=ctx.createAnalyser();
src.connect(analyser);
analyser.connect(ctx.destination);
const canvas=document.getElementById('viz');
canvas.width=${c.size};
canvas.height=60;
const cctx=canvas.getContext('2d');

function draw(){
  requestAnimationFrame(draw);
  const data=new Uint8Array(analyser.frequencyBinCount);
  analyser.getByteFrequencyData(data);
  cctx.clearRect(0,0,canvas.width,canvas.height);
  data.slice(0,40).forEach((v,x)=>{
    cctx.fillRect(x*6,canvas.height-v/4,4,v/4);
  });
}
audio.onplay=()=>ctx.resume();
draw();

load(0);
<\/script>
`;
}

function getConfig(){
  return {
    size:size.value,
    primary:primary.value,
    text:text.value,
    cover:cover.value,
    tracks:JSON.parse(tracks.value)
  }
}

function updatePreview(){
  preview.srcdoc=buildPlayer(getConfig());
  preview.style.width=size.value+'px';
  preview.style.height='520px';
}

function generateCode(){
  navigator.clipboard.writeText(buildPlayer(getConfig()));
  alert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω');
}
</script>

</body>
</html>
