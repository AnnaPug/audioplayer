<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Audio Player Editor</title>

<style>
body{
  margin:0;
  display:flex;
  height:100vh;
  font-family:sans-serif;
  background:#0b0f1a;
  color:#fff;
}

.panel{
  width:320px;
  padding:16px;
  background:#11162a;
  box-sizing:border-box;
}

label{
  display:block;
  margin-top:10px;
  font-size:13px;
}

input{
  width:100%;
  margin-top:6px;
  padding:6px;
  border-radius:6px;
  border:none;
  background:#1b2040;
  color:#fff;
}

button{
  margin-top:12px;
  width:100%;
  padding:8px;
  border:none;
  border-radius:6px;
  background:#8b5cf6;
  color:#fff;
  cursor:pointer;
}

.preview{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
}

iframe{
  border:none;
  background:transparent;
}
</style>
</head>

<body>

<!-- ===== EDITOR ===== -->
<div class="panel">
  <h3>Audio Player Editor</h3>

  <label>Размер плеера</label>
  <input type="range" id="size" min="220" max="420" value="300">

  <label>Основной цвет</label>
  <input type="color" id="primary" value="#8b5cf6">

  <label>Обложка (URL)</label>
  <input id="cover" placeholder="https://...">

  <button onclick="updatePreview()">Обновить предпросмотр</button>
</div>

<!-- ===== PREVIEW ===== -->
<div class="preview">
  <iframe id="preview"></iframe>
</div>

<script>
/* ===== ЗАГРУЗКА ТРЕКОВ ИЗ GITHUB ===== */
async function loadTracks(){
  const url = 'https://api.github.com/repos/AnnaPug/audioplayer/contents/audio';
  const res = await fetch(url);
  const data = await res.json();

  return data
    .filter(f => /\.(mp3|wav|ogg)$/i.test(f.name))
    .map(f => ({
      title: f.name.replace(/\.[^/.]+$/, ''),
      src: f.download_url
    }));
}

/* ===== ПЛЕЕР (СТАБИЛЬНАЯ ВЕРСИЯ) ===== */
function buildPlayer(cfg){
return `
<!DOCTYPE html>
<html>
<head>
<style>
body{margin:0;background:transparent}

#player{
  width:${cfg.size}px;
  font-family:sans-serif;
  color:white;
}

#cover{
  width:100%;
  border-radius:16px;
}

#title{
  text-align:center;
  margin:8px 0;
}

.controls{
  display:flex;
  justify-content:space-around;
  margin-top:10px;
}

button{
  width:44px;
  height:44px;
  border-radius:50%;
  border:none;
  background:${cfg.primary};
  color:white;
}

#playlist{
  display:none;
  margin-top:8px;
}

#playlist div{
  padding:4px;
  cursor:pointer;
}

input[type=range]{
  width:100%;
}
</style>
</head>

<body>

<div id="player">
  <img id="cover">
  <div id="title"></div>

  <input type="range" id="progress" value="0">

  <div class="controls">
    <button id="prev">⏮</button>
    <button id="play">▶</button>
    <button id="next">⏭</button>
    <button id="list">☰</button>
  </div>

  <input type="range" id="volume" min="0" max="1" step="0.01">

  <div id="playlist"></div>

  <audio id="audio"></audio>
</div>

<script>
const tracks = ${JSON.stringify(cfg.tracks)};
let index = 0;

const audio = document.getElementById('audio');
const playBtn = document.getElementById('play');
const title = document.getElementById('title');
const cover = document.getElementById('cover');
const playlist = document.getElementById('playlist');
const volume = document.getElementById('volume');
const progress = document.getElementById('progress');

cover.src = "${cfg.cover || ''}";
audio.volume = 0.8;
volume.value = 0.8;

tracks.forEach((t,i)=>{
  const d = document.createElement('div');
  d.textContent = t.title;
  d.onclick = () => { load(i); play(); };
  playlist.appendChild(d);
});

function load(i){
  index = i;
  audio.src = tracks[i].src;
  title.textContent = tracks[i].title;
}

function play(){
  audio.play();
  playBtn.textContent = '⏸';
}

playBtn.onclick = () => {
  if(audio.paused) play();
  else{
    audio.pause();
    playBtn.textContent = '▶';
  }
};

document.getElementById('next').onclick = () => {
  index = (index + 1) % tracks.length;
  load(index);
  play();
};

document.getElementById('prev').onclick = () => {
  index = (index - 1 + tracks.length) % tracks.length;
  load(index);
  play();
};

document.getElementById('list').onclick = () => {
  playlist.style.display =
    playlist.style.display === 'block' ? 'none' : 'block';
};

volume.oninput = e => audio.volume = e.target.value;

audio.ontimeupdate = () => {
  progress.max = audio.duration || 0;
  progress.value = audio.currentTime || 0;
};

progress.oninput = e => audio.currentTime = e.target.value;

load(0);
<\/script>

</body>
</html>
`;
}

/* ===== PREVIEW ===== */
async function updatePreview(){
  const tracks = await loadTracks();

  const cfg = {
    size: size.value,
    primary: primary.value,
    cover: cover.value,
    tracks
  };

  preview.srcdoc = buildPlayer(cfg);
  preview.style.width = cfg.size + 'px';
  preview.style.height = '520px';
}

updatePreview();
</script>

</body>
</html>
